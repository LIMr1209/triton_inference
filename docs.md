## 启动
- docker [Tag](!https://catalog.ngc.nvidia.com/orgs/nvidia/containers/tritonserver)
```shell
docker pull nvcr.io/nvidia/tritonserver:23.11-py3
docker run -v /var/run/docker.sock:/var/run/docker.sock --net=host --gpus all --shm-size=4g --ulimit memlock=-1 --ulimit stack=67108864 -it nvcr.io/nvidia/tritonserver:23.11-py3 bash
```

- 服务启动
```shell
tritonserver --model-repository /opt/tritonserver/models --load-model=* --model-control-mode=explicit
```
- Triton 仅加载那些使用 --load-model命令行选项明确指定的模型。要在启动时加载所有模型，请指定 --load-model=*为 ONLY--load-model参数。--load-model=*与另一个参数一起指定 --load-model将导致错误。如果--load-model未指定，则启动时不会加载任何模型。
- API 加载卸载模型 [docs](!https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/protocol/extension_model_repository.html)
- Triton 提供Prometheus指标  `curl localhost:8002/metrics` [docs](!https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/user_guide/metrics.html)

- [模型分析器](!https://github.com/triton-inference-server/model_analyzer/blob/r23.12/docs/quick_start.md)
```shell
pip install triton-model-analyzer
model-analyzer profile \
    --model-repository /opt/tritonserver/models \
    --profile-models onnxruntime_background --triton-launch-mode=docker \
    --output-model-repository-path /opt/tritonserver/o_models/onnxruntime_background \
    --export-path profile_results
```

## API 服务
- 查询配置 [doc](!https://docs.nvidia.com/deeplearning/triton-inference-server/user-guide/docs/user_guide/model_configuration.html)
```shell
curl localhost:8000/v2/models/tensorrt_background/config | python -m json.tool
```
- 每个模型可以有一个或多个 版本。模型配置的 ModelVersionPolicy属性 用于设置以下策略之一。

  全部：模型存储库中可用的模型的所有版本都可用于推理。 version_policy: { all: {}}

  最新：只有存储库中模型的最新“n”个版本可用于推理。该模型的最新版本是数字上最大的版本号。 version_policy: { latest: { num_versions: 2}}  
  
  Specific：只有特别列出的模型版本可用于推理。 version_policy: { specific: { versions: [1,3]}}
                                                                                                                                                                                                                                                                                                                                                                                                                                          v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
## tensorrtllm_backend

- docker
```shell
docker pull nvcr.io/nvidia/tritonserver:23.11-trtllm-python-py3

```
- 安装TensorRT-LLM
```shell
apt-get update
apt-get install git-lfs
pip3 install tensorrt_llm -U --extra-index-url https://pypi.nvidia.com
python3 -c "import tensorrt_llm; print(tensorrt_llm.__version__)"
cd /opt/tritonserver/backends/
git clone https://github.com/triton-inference-server/tensorrtllm_backend.git
git lfs install
git submodule update --init --recursive
cd /opt/tritonserver/backends/tensorrtllm_backend/tensorrt_llm/
git checkout v0.7.1
cd /opt/tritonserver/backends/tensorrtllm_backend/tensorrt_llm/examples/chatglm
python3 build.py -m chatglm2_6b_32k --model_dir /root/chatglm2-6b-32k --output_dir /root/chatglm2-6b-32k/fp16/1-gpu

```
## tensorrt_background
- 文档 [Torch-TensorRT](!https://pytorch.org/TensorRT/)
- cuda-python 版本 nvcc 匹配 文档[CUDA-Python](!https://nvidia.github.io/cuda-python/install.html)
- [trtexec命令](!https://developer.nvidia.com/zh-cn/blog/tensorrt-trtexec-cn/)
- [TensorRT容器](!https://catalog.ngc.nvidia.com/orgs/nvidia/containers/tensorrt/tags)
- NVIDIA TensorRT™ 是用于高性能深度学习推理的 SDK。此 SDK 包含深度学习推理优化器和运行时环境，可为深度学习推理应用提供低延迟和高吞吐量。EA 指 Early Access，即抢先体验版本，一般是在正式发布之前供广大用户提前体验。GA 指 General Availability，一般是经过验证发布的稳定版本，即正式版本。
- 查看cudnn 版本
```shell
# 9.0.0
cat /usr/include/cudnn_version.h | grep -A 5 MAJOR
#define CUDNN_MAJOR 9
#define CUDNN_MINOR 0
#define CUDNN_PATCHLEVEL 0
```
- ldd 查询 `so` 依赖项